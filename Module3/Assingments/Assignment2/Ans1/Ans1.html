<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Todo App</title>
<style>
    body { font-family: Arial; background:#f2f2f2; padding:20px; }
    h1 { text-align:center; }
    #todoList { max-width:600px; margin:auto; background:white; padding:20px; border-radius:8px; }
    .todo { display:flex; justify-content:space-between; align-items:center;
            border-bottom:1px solid #ddd; padding:10px 0; }
    .completed { color:green; font-weight:bold; }
    button { padding:5px 10px; margin-left:10px; cursor:pointer; border:none; border-radius:5px; }
    .del { background:red;  color:white; }
    .toggle { background:blue; color:white; }
    #empty { text-align:center; color:#888; padding:10px; }
</style>
</head>
<body>

<h1>Todo Application</h1>
<div id="todoList"></div>

<script>

// ------------------ 1. Fetch Todos From API ------------------
async function fetchTodos() {
    const response = await fetch("https://jsonplaceholder.typicode.com/todos");
    const data = await response.json();

    const first20 = data.slice(0, 20);  // take first 20
    storeTodos(first20);
    renderTodos();
}

// ------------------ 2. Store in LocalStorage ------------------
function storeTodos(todos) {
    localStorage.setItem("todos", JSON.stringify(todos));
}

// ------------------ 3. Retrieve from LocalStorage ------------------
function getTodos() {
    return JSON.parse(localStorage.getItem("todos")) || [];
}

// ------------------ 4. Render to UI ------------------
function renderTodos() {
    const container = document.getElementById("todoList");
    const todos = getTodos();

    container.innerHTML = ""; // Clear previous UI

    if (todos.length === 0) {
        container.innerHTML = `<p id="empty">No Todos Available</p>`;
        return;
    }

    todos.forEach(todo => {
        const div = document.createElement("div");
        div.className = "todo";

        div.innerHTML = `
            <span><b>${todo.title}</b> - 
                <span class="${todo.completed ? 'completed' : ''}">
                    ${todo.completed ? "Completed" : "Pending"}
                </span>
            </span>
            <div>
                <button class="toggle" onclick="toggleStatus(${todo.id})">Toggle</button>
                <button class="del" onclick="deleteTodo(${todo.id})">Delete</button>
            </div>
        `;
        container.appendChild(div);
    });
}

// ------------------ 5. Delete Todo ------------------
function deleteTodo(id) {
    let todos = getTodos().filter(todo => todo.id !== id);
    storeTodos(todos);
    renderTodos();
}

// ------------------ Bonus: Toggle Complete ------------------
function toggleStatus(id) {
    let todos = getTodos().map(todo => {
        if (todo.id === id) todo.completed = !todo.completed;
        return todo;
    });
    storeTodos(todos);
    renderTodos();
}

// ------------------ INIT CALL ------------------
if (!localStorage.getItem("todos")) fetchTodos();
else renderTodos();

</script>

</body>
</html>
